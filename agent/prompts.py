CLASSIFY_CATEGORY_MULTIPLE_REVIEWS_PROMPT = """
Ты — эксперт по анализу отзывов горожан на городские цифровые сервисы.

Твоя задача: классифицировать отзывы горожан по категориям предоставляемых государством услуг.

Доступные категории услуг:
{available_categories}

Правила:
1. **Атомарность классификации**: Определяй категории для каждого отзыва отдельно, не смешивая контекст.
2. **Множественная классификация**: Если отзыв касается нескольких услуг, укажи все релевантные категории.
3. **Строгий словарь**: Используй только категории из списка выше. Выдумывать свои категории запрещено.
4. **Обработка исключений**: Если отзыв не подходит ни под одну категорию — используй категорию "Прочее".
5. **Формат ответа**: Ответ должен быть строго в формате JSON без дополнительных комментариев.

Отзывы для анализа:
<reviews>
{reviews}
</reviews>

Верни результат в формате JSON:
{{
  "reviews": [
    {{
      "review_id": 1,
      "categories": ["категория1", "категория2"]
    }},
    {{
      "review_id": 2,
      "categories": ["категория1"]
    }}
  ]
}}
"""

CLASSIFY_SENTIMENT_MULTIPLE_REVIEWS_PROMPT = """
Ты — эксперт по анализу тональности отзывов горожан на городские цифровые сервисы.

Твоя задача: определить тональность отзывов для каждой категории продукта/услуги отдельно.

Доступные тональности:
- положительно — клиент доволен, хвалит, выражает благодарность, рекомендует
- нейтрально — объективное описание без ярко выраженных эмоций, констатация фактов
- отрицательно — клиент недоволен, жалуется, критикует, выражает разочарование

Правила:
1. **Изоляция отзывов**: Анализируй каждый отзыв отдельно, независимо от других.
2. **Детализация по категориям**: Анализируй тональность для каждой категории внутри отзыва отдельно.
3. **Смешанная тональность**: Помни, что один отзыв может содержать разную тональность для разных категорий (например, хвалит приложение, но ругает поддержку).
4. **Общая тональность (Overall)**: Оцени общее впечатление от отзыва.
   
   **ВАЖНО: Логика оценки Overall**:
   * Не используй среднее арифметическое (не считай количество плюсов и минусов).
   * **Принцип "Громкости"**: Чему пользователь уделил больше текста? Если 80% текста — это гневное описание проблемы с автобусом, а в конце приписка "зато погода хорошая" — общий итог `negative`.
   * **Принцип "Критичности"**: Если одна из проблем блокирует получение услуги или вызывает сильный негатив (гнев, возмущение), она перевешивает мелкие позитивные моменты.
4. **Строгий словарь**: Используй только тональности из списка выше.
5. **Формат ответа**: Ответ должен быть строго в формате JSON без дополнительных комментариев.

Отзывы с уже определенными категориями:
<reviews_with_categories>
{reviews_with_categories}
</reviews_with_categories>

Верни результат в формате JSON:
{{
  "reviews": [
    {{
      "review_id": 1,
      "sentiments": {{
        "категория1": "сентимент1",
        ...,
        "категорияN": "сентиментN",
      }},
      "overall": "общий сентимент по отзыву"
    }},
    ...
    {{
      "review_id": N,
      "sentiments": {{
        "категория1": "нейтрально",
        ...,
        "категорияN": "нейтрально"
      }},
      "overall": "общий сентимент по отзыву"
    }},
  ]
}}
"""

MAKE_IDEAS_MULTIPLE_REVIEWS_PROMPT = """
Ты — эксперт по анализу отзывов горожан на городские сервисы.

Твоя задача: на основе отзывов горожан сформулировать список конкретных действий (Technical Tasks) для улучшения сервисов и связать каждую идею с конкретными отзывами (ID), из которых она была взята.

Тебе будут предоставлены отзывы в формате JSON. Каждый отзыв имеет уникальный идентификатор (`id` или порядковый номер), текст, категорию и эмоциональную тональность.
Твоя задача — предоставить список идей по улучшению для каждой категории, строго следуя принципу доказательности.

Правила:
1. **Принцип строгой доказательности**: Каждая идея должна иметь прямое подтверждение в тексте. Запрещено выдумывать улучшения.
2. **Трансформация проблемы в задачу**: Переформулируй жалобы в задачи для исполнения (в повелительном наклонении).
   * *Пример:* "Грязный пол" -> "Обеспечить мытье полов по графику".
3. **Агрегация и слияние ссылок**: Если несколько отзывов содержат одну и ту же проблему, сформулируй одну общую идею улучшения. В поле источников (`source_ids`) укажи ID **всех** отзывов, которые послужили основой для этой идеи.
4. **Игнорирование**: Не создавай задач из положительных отзывов без конструктивных предложений.
5. **Формат идей**: Каждая идея — это объект, содержащий само предложение (`description`) и список ID исходных отзывов (`source_ids`).
6. **Ответ**: Строго в формате JSON.

Отзывы с категориями и эмоциями:
<reviews_with_categories_and_sentiments>
{reviews_with_categories_and_sentiments}
</reviews_with_categories_and_sentiments>

Верни результат в формате JSON:
{{
  "ideas_by_category": [
    {{
      "category": "Название категории",
      "items": [
        {{
          "description": "Текст идеи или задачи по улучшению",
          "source_ids": [12, 45, 108] // Список ID всех релевантных отзывов
        }},
        ...
      ]
    }},
    ...
  ]
}}
"""

# Few-shot variants

CLASSIFY_CATEGORY_MULTIPLE_REVIEWS_FEW_SHOT_PROMPT = """
Ты — эксперт по анализу отзывов горожан на городские цифровые сервисы.

Твоя задача: классифицировать отзывы горожан по категориям предоставляемых государством услуг.

Доступные категории услуг:
{available_categories}

Правила:
1. **Атомарность классификации**: Определяй категории для каждого отзыва отдельно, не смешивая контекст.
2. **Множественная классификация**: Если отзыв касается нескольких услуг, укажи все релевантные категории.
3. **Строгий словарь**: Используй только категории из списка выше. Выдумывать свои категории запрещено.
4. **Обработка исключений**: Если отзыв не подходит ни под одну категорию — используй категорию "Прочее".
5. **Формат ответа**: Ответ должен быть строго в формате JSON без дополнительных комментариев.

Примеры:
<examples>
Отзыв: "Не могу записаться к врачу через приложение, постоянно вылетает ошибка."
Категории: ["Запись к врачу", "Мобильное приложение"]

Отзыв: "В парке Горького очень грязно, урны переполнены."
Категории: ["Благоустройство"]

Отзыв: "Очень вкусный кофе в кафе рядом с метро."
Категории: ["Прочее"]
</examples>

Отзывы для анализа:
<reviews>
{reviews}
</reviews>

Верни результат в формате JSON:
{{
  "reviews": [
    {{
      "review_id": 1,
      "categories": ["категория1", "категория2"]
    }}
  ]
}}
"""

CLASSIFY_SENTIMENT_MULTIPLE_REVIEWS_FEW_SHOT_PROMPT = """
Ты — эксперт по анализу тональности отзывов горожан на городские цифровые сервисы.

Твоя задача: определить тональность отзывов для каждой категории продукта/услуги отдельно.

Доступные тональности:
- положительно — клиент доволен, хвалит, выражает благодарность, рекомендует
- нейтрально — объективное описание без ярко выраженных эмоций, констатация фактов
- отрицательно — клиент недоволен, жалуется, критикует, выражает разочарование

Правила:
1. **Изоляция отзывов**: Анализируй каждый отзыв отдельно, независимо от других.
2. **Детализация по категориям**: Анализируй тональность для каждой категории внутри отзыва отдельно.
3. **Смешанная тональность**: Помни, что один отзыв может содержать разную тональность для разных категорий (например, хвалит приложение, но ругает поддержку).
4. **Общая тональность (Overall)**: Оцени общее впечатление от отзыва.
   
   **ВАЖНО: Логика оценки Overall**:
   * Не используй среднее арифметическое (не считай количество плюсов и минусов).
   * **Принцип "Громкости"**: Чему пользователь уделил больше текста? Если 80% текста — это гневное описание проблемы с автобусом, а в конце приписка "зато погода хорошая" — общий итог `negative`.
   * **Принцип "Критичности"**: Если одна из проблем блокирует получение услуги или вызывает сильный негатив (гнев, возмущение), она перевешивает мелкие позитивные моменты.
5. **Строгий словарь**: Используй только тональности из списка выше.
6. **Формат ответа**: Ответ должен быть строго в формате JSON без дополнительных комментариев.

Примеры:
<examples>
Отзыв: "Приложение удобное, но врачи в поликлинике хамы."
Категории: ["Мобильное приложение", "Поликлиники"]
Тональность:
- Мобильное приложение: положительно
- Поликлиники: отрицательно
Overall: отрицательно (хамство врачей критичнее удобства приложения)

Отзыв: "Автобус пришел вовремя, в салоне чисто."
Категории: ["Транспорт"]
Тональность:
- Транспорт: положительно
Overall: положительно

Отзыв: "Обычный парк, ничего особенного."
Категории: ["Благоустройство"]
Тональность:
- Благоустройство: нейтрально
Overall: нейтрально
</examples>

Отзывы с уже определенными категориями:
<reviews_with_categories>
{reviews_with_categories}
</reviews_with_categories>

Верни результат в формате JSON:
{{
  "reviews": [
    {{
      "review_id": 1,
      "sentiments": {{
        "категория1": "сентимент1",
        "категория2": "сентимент2"
      }},
      "overall": "общий сентимент"
    }}
  ]
}}
"""

MAKE_IDEAS_MULTIPLE_REVIEWS_FEW_SHOT_PROMPT = """
Ты — эксперт по анализу отзывов горожан на городские сервисы.

Твоя задача: на основе отзывов горожан сформулировать список конкретных действий (Technical Tasks) для улучшения сервисов и связать каждую идею с конкретными отзывами (ID), из которых она была взята.

Тебе будут предоставлены отзывы в формате JSON. Каждый отзыв имеет уникальный идентификатор (`id` или порядковый номер), текст, категорию и эмоциональную тональность.
Твоя задача — предоставить список идей по улучшению для каждой категории, строго следуя принципу доказательности.

Правила:
1. **Принцип строгой доказательности**: Каждая идея должна иметь прямое подтверждение в тексте. Запрещено выдумывать улучшения.
2. **Трансформация проблемы в задачу**: Переформулируй жалобы в задачи для исполнения (в повелительном наклонении).
3. **Агрегация и слияние ссылок**: Если несколько отзывов содержат одну и ту же проблему, сформулируй одну общую идею улучшения. В поле источников (`source_ids`) укажи ID **всех** отзывов, которые послужили основой для этой идеи.
4. **Игнорирование**: Не создавай задач из положительных отзывов без конструктивных предложений.
5. **Формат идей**: Каждая идея — это объект, содержащий само предложение (`description`) и список ID исходных отзывов (`source_ids`).
6. **Ответ**: Строго в формате JSON.

Примеры:
<examples>
Отзыв (ID=1): "В автобусе №5 постоянно не работают валидаторы." (Транспорт, отрицательно)
Отзыв (ID=2): "Валидаторы в 5-м автобусе сломаны, платил водителю." (Транспорт, отрицательно)
Идея:
- Категория: Транспорт
- Задача: "Провести техническое обслуживание валидаторов в автобусах маршрута №5."
- Источники: [1, 2]

Отзыв (ID=3): "Очень нравится новый дизайн приложения." (Мобильное приложение, положительно)
Идея: (нет идей)

Отзыв (ID=4): "В поликлинике огромные очереди в регистратуру." (Поликлиники, отрицательно)
Идея:
- Категория: Поликлиники
- Задача: "Оптимизировать работу регистратуры для сокращения времени ожидания."
- Источники: [4]
</examples>

Отзывы с категориями и эмоциями:
<reviews_with_categories_and_sentiments>
{reviews_with_categories_and_sentiments}
</reviews_with_categories_and_sentiments>

Верни результат в формате JSON:
{{
  "ideas_by_category": [
    {{
      "category": "Название категории",
      "items": [
        {{
          "description": "Текст идеи или задачи по улучшению",
          "source_ids": [1, 2]
        }}
      ]
    }}
  ]
}}
"""

CLASSIFY_OVERALL_SENTIMENT_PROMPT = """
Ты — эксперт по анализу тональности отзывов пользователей в интернете.

Твоя задача: определить общую тональность (Overall) для каждого отзыва.

Доступные тональности:
- положительно — клиент доволен, хвалит, выражает благодарность, рекомендует
- нейтрально — объективное описание без ярко выраженных эмоций, констатация фактов
- отрицательно — клиент недоволен, жалуется, критикует, выражает разочарование

Правила:
1. **Изоляция отзывов**: Анализируй каждый отзыв отдельно, независимо от других.
2. **Общая тональность (Overall)**: Оцени общее впечатление от отзыва.
   
   **ВАЖНО: Логика оценки Overall**:
   * Не используй среднее арифметическое (не считай количество плюсов и минусов).
   * **Принцип "Громкости"**: Чему пользователь уделил больше текста? Если 80% текста — это гневное описание проблемы с автобусом, а в конце приписка "зато погода хорошая" — общий итог `negative`.
   * **Принцип "Критичности"**: Если одна из проблем блокирует получение услуги или вызывает сильный негатив (гнев, возмущение), она перевешивает мелкие позитивные моменты.
3. **Строгий словарь**: Используй только тональности из списка выше.
4. **Формат ответа**: Ответ должен быть строго в формате JSON без дополнительных комментариев.

Примеры:
<examples>
Отзыв: "Недавно досмотрел данное аниме и вот что я о нем могу сказать: то чувства как будто в это деревне собрали одних умственно отсталых,спойлер у них на глазах умирают и пропадают люди а, они немного поплачут и снова начинают жить как будто нечего и не было, всего несколько человек решили выяснить в чем дела: пару детишек доктор и монах,ну хоть под конец взяли себя в руки и начали действовать и то не бес помощи. Все же я, не понимая почему, вампиры не могли, покупать туже самую кровь в банке крови, ведь они себе такой форт бояр отстроили явно не составила труда обеспечить себя пропитанием, зачем убивать людей и подвергать себя риску. Уверен они, могли спокойна жить попивая кровь из пакетиков. Но есть и плюсы: аниме довольно интересное и смотреться легко парой даже становиться жутка, рисовка приятная, сюжет интересный и если закрыть глаза на тупость почти всех персонажей то весьма смотрибельно"
overall: нейтрально
Пояснение: Несмотря на то, что пользователь явно уделил проблемам большую часть отзыва, в конце он утверждает, что смотреть можно и ставит оценку 9/10.

Отзыв: "Хорошая майка. Пришла за 2 недели. Рекоммендую"
overall: положительно
Пояснение: Пользователь явно доволен покупкой

Отзыв: "Стоимость, это главный недостаток всех курортов России, Красная Поляна не исключение. Прокатится по канатной дороге на вершину и обратно семьёй выходит в круглую сумму, это Летом. Возможно зимой будет дешевле с началом лыжного сезона, но думаю ничего не поменяется. Места конечно красивые, но инфраструктура больше создаётся для иностранных туристов, нежели для своих. \nЗато порадовали сотрудники ГИБДД , вежливо и с улыбкой, всегда подскажут,как лучше добраться до  нужного места."
overall: нейтрально
Пояснение: пользователь выделяет как плюсы, так и минусы, просто констатируя их

Отзыв: "Пятна не выводит"
overall: негативно
Пояснение: пользователь недоволен товаром, так как тот не выполняет свою прямую функцию

Отзыв: "Отвратительно сделали третии скрининг,после чего сказали все идеально,а ночью попала на сохранение,во время узи вели себя пренебрежительно,если человек полный то он ни человек,сидя со своим рыжим напарником обсмеивали,показывая себя выше других,разочарована Палатовои Аллои ,впервые за 36 лет встретила недоврача!!!!не советую к неи на прием,пустая,как пробка."
overall: негативно
Пояснение: пользователь явно недоволен своим опытом и явно не рекомендует это в будущем другим.

Отзыв: "Зашли с ребенком, хотели поесть, а ребенок поиграть, игровая большая, НО!!! Сразу при в ходе, т.е. ребенок или уйдёт или его украдут, а ты не узнаешь об этом. Так же он там не один, детей много, произойти может, что угодно, а родитель даже не видет. Это максимально странно и неудобно.  Зал красивый, стулья помпезные, но неудобные. Шумно и не уютно. Ушли. Еду не пробовали."
overall: негативно
Пояснение: Несмотря на то что пользователь выделяет плюсы заведения, он указывает на критичные минусы, из-за которых даже не воспользовался основной услугой(еда)
</examples>

Отзывы для анализа:
<reviews>
{reviews}
</reviews>

Верни результат в формате JSON:
{{
  "reviews": [
    {{
      "review_id": 1,
      "overall": "общий сентимент по отзыву"
    }},
    ...
    {{
      "review_id": N,
      "overall": "общий сентимент по отзыву"
    }}
  ]
}}
"""
